<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Smart Location Sender â€” Working Version</title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
        body {
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; padding: 20px;
            background: linear-gradient(135deg, #1e1e1e, #3b3b3b);
            color: #fff;
        }
        .container {
            width: 100%; max-width: 450px; background: #2a2a2a;
            padding: 25px; border-radius: 16px; text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        h2 { margin-bottom: 18px; font-size: 26px; font-weight: bold; }
        .btn {
            padding: 14px 24px; font-size: 18px; border: none;
            border-radius: 10px; cursor: pointer; color: #fff; width: 100%;
        }
        .btn-primary { background: #4caf50; }
        .btn-secondary { background: #64748b; }
        .btn:active { transform: translateY(1px); }
        #status { margin-top: 18px; font-size: 16px; color: #ddd; min-height: 24px; }

        /* Popup overlay */
        #popup-bg {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.7);
            display: none; justify-content: center; align-items: center;
            z-index: 9999;
        }
        #popup {
            width: 92%; max-width: 420px; background: #fff; color: #111;
            border-radius: 12px; padding: 18px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.5);
        }
        #popup h3 { margin-bottom: 8px; font-size: 18px; }
        #popup p { margin-bottom: 12px; color: #334155; font-size: 14px; line-height: 1.4; }
        .popup-row { display:flex; gap:10px; }
        .small-note { font-size: 13px; color: #475569; margin-top: 8px; }
        .instructions {
            font-size: 13px; background:#f8fafc; padding:10px; border-radius:8px; color:#0f172a; margin-top:8px;
        }
        .link-like { color:#2563eb; cursor:pointer; text-decoration:underline; }
    </style>
</head>
<body>

<div class="container">
    <h2>Send My Location</h2>
    <button id="openBtn" class="btn btn-primary" onclick="openPopup()">Send Location</button>
    <p id="status"></p>
</div>

<!-- Popup modal -->
<div id="popup-bg" aria-hidden="true">
    <div id="popup" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
        <h3 id="popupTitle">Enable location</h3>
        <p id="popupMessage">This site needs your location to send accurately. Click <strong>Allow</strong> when the browser asks.</p>

        <div id="popupContent">
            <div class="popup-row" style="margin-bottom:8px;">
                <button id="allowBtn" class="btn btn-primary" onclick="onAllowClick()">Allow</button>
                <button id="cancelBtn" class="btn btn-secondary" onclick="closePopup()">Cancel</button>
            </div>
            <div class="small-note">If you previously blocked location, follow the instructions after clicking "Show instructions".</div>
            <div style="margin-top:8px;">
                <span class="link-like" onclick="showInstructions()">Show instructions</span>
            </div>
        </div>

        <div id="instructions" style="display:none; margin-top:12px;">
            <div class="instructions" id="instrText">
                <strong>How to re-enable location (Chrome desktop):</strong>
                <ol style="margin-top:8px; padding-left:18px;">
                    <li>Click the lock icon left of the URL bar.</li>
                    <li>Find "Location" and set it to "Allow".</li>
                    <li>Reload this page.</li>
                </ol>
                <div style="margin-top:8px;">
                    <button class="btn btn-primary" onclick="tryOpenSettings()">Reload page</button>
                    <button class="btn btn-secondary" onclick="closePopup()" style="margin-top:8px;">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Firebase SDK -->
<!-- Firebase SDK (compat version for plain HTML) -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>


<script>
    // Initialize Firebase


  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyC_gB_Q4kplOrkdLd14MQoOi3Y4hXPLSTo",
    authDomain: "testprojectforlocation-5fbdc.firebaseapp.com",
    databaseURL: "https://testprojectforlocation-5fbdc-default-rtdb.firebaseio.com",
    projectId: "testprojectforlocation-5fbdc",
    storageBucket: "testprojectforlocation-5fbdc.appspot.com",
    messagingSenderId: "251395937912",
    appId: "1:251395937912:web:33bd84dbe3d9939cca7f8d"
  };

    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
  // Initialize Firebase
//   const app = firebase.initializeApp(firebaseConfig);
//   const database = firebase.database();

  // Open / Close popup
  function openPopup() { document.getElementById("popup-bg").style.display = "flex"; }
  function closePopup() { document.getElementById("popup-bg").style.display = "none"; }
  function showInstructions() { document.getElementById("instructions").style.display = "block"; }
  function tryOpenSettings() { location.reload(); }

  // Called when user clicks "Allow"
  function onAllowClick() {
    closePopup();
    sendLocation();
  }

  // Send location
  async function sendLocation() {
    document.getElementById("status").innerText = "Checking GPS...";

    navigator.geolocation.getCurrentPosition(
      async (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        document.getElementById("status").innerText = "GPS success! Sending location...";

        await sendToFirebase(lat, lon); // wait for send to finish
      },
      (err) => {
        console.error("Geolocation error:", err);
        alert("Your location is OFF or blocked.\n\nPlease enable GPS and try again.");
        document.getElementById("status").innerText = "Location is OFF. Not sent.";
      },
      { enableHighAccuracy: true, timeout: 10000 }
    );
  }

  // Send data to Firebase with proper error handling
  async function sendToFirebase(lat, lon) {
    try {
      const newLocationRef = database.ref('locations').push();
      await newLocationRef.set({
        latitude: lat,
        longitude: lon,
        timestamp: Date.now()
      });
      console.log("Location sent:", lat, lon);
      document.getElementById("status").innerText = "Location sent successfully!";
    } catch (err) {
      console.error("Firebase write error:", err);
      document.getElementById("status").innerText = "Failed to send location!";
    }
  }
</script>

</body>
</html>

